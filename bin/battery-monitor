#!/usr/bin/python

import time
import sys
# import Raspi UPS Hat library
import raspiupshat

# init Raspi UPS Hat
raspiupshat.init();

voltageDeltaThreshold = 0.1;

initialVoltage = raspiupshat.getv();
initialBattery = raspiupshat.getsoc();

while 1:
    time.sleep(2)
    currentVoltage = raspiupshat.getv();
    voltageDelta = initialVoltage - currentVoltage;
    
    print "InitVol: %f InitVol: %f CurrVol: %f Delta: %f" % (initialBattery, initialVoltage, currentVoltage, voltageDelta);
    
    if voltageDelta > voltageDeltaThreshold:
        print "Voltage power has dropped, powering off..."
        os.system("omxplayer /home/pi/carpi/resources/media/low-voltage-english.m4a")
        # os.system("sudo poweroff")